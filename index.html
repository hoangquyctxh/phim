<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"/>
  <title>Phim Online | Giao diện sáng, chữ trắng rõ nét</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {background:#181818;margin:0;padding:0;font-family:'Segoe UI',Arial,sans-serif;color:#fff;}
    html,body{min-height:100vh;}
    ::-webkit-scrollbar { width: 8px; background: #232323;}
    ::-webkit-scrollbar-thumb { background: #e50914; border-radius:5px;}
    header {position:sticky;top:0;z-index:3000;background:rgba(32,32,32,0.98);padding:13px 18px 13px 24px;display:flex;gap:17px;align-items:center;box-shadow:0 2px 14px #1114;}
    header h1 {margin:0;font-size:2.15em;color:#e50914;font-weight:700;letter-spacing:.5px; text-shadow:0 2px 12px #000c;}
    #search,#genres{padding:8px 17px;font-size:1em;border-radius:7px;border:none;background:#232323;color:#fff;}
    #search:focus,#genres:focus{box-shadow:0 2px 9px #e5091442;}
    .hero{width:100vw;min-height:220px;max-height:35vw;background:#1c1c1c url('https://images.unsplash.com/photo-1465101162946-4377e57745c3?auto=format&fit=crop&w=900&q=60') no-repeat center/cover;position:relative;box-shadow:0 15px 60px #0008 inset;}
    .hero-info{position:absolute;bottom:20px;left:52px;max-width:42vw;color:#fff;text-shadow:0 3px 15px #000b;}
    .hero-title{font-size:2.2em;font-weight:bold;margin:0 0 7px 0;color:#fff;}
    .hero-desc{font-size:1.14em;opacity:.95;margin:0 0 10px 0;color:#e2e2e2;}
    .hero-btn{padding:11px 28px;font-size:1.12em;font-weight:bold;background:#e50914;color:#fff;border:none;border-radius:40px;margin-top:7px;cursor:pointer;transition:.15s;}
    .hero-btn:hover{background:#bf0e19;}
    .row-title{font-size:1.11em;color:#ffef79;margin:32px 30px 10px 24px;font-weight:700;letter-spacing:.5px;}
    .movie-row{display:flex;flex-direction:row;overflow-x:auto;gap:28px;padding:0 2vw 18px 2vw;scroll-behavior:smooth;}
    .movie-card{width:196px;min-width:196px;background:linear-gradient(120deg,#232323 83%,#181818 100%);border-radius:16px;overflow:hidden;margin-bottom:17px;box-shadow:0 6px 29px #0005;cursor:pointer;position:relative;transition:transform .16s,box-shadow .18s;}
    .movie-card:hover{transform:scale(1.07) translateY(-6px);box-shadow:0 18px 40px #e5091428;}
    .movie-poster{width:100%;aspect-ratio:2/3;object-fit:cover;}
    .movie-info{padding:11px 13px 15px 13px; color:#fff;}
    .movie-title{font-size:1.12em;font-weight:600;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#fff;}
    .movie-genre,.movie-year{font-size:0.99em;opacity:.82;color:#fffd;}
    .movie-rating{color:#fadb3a;font-weight:bold; font-size:1.04em;}
    .movie-desc{color:#e2e2e2;font-size:.95em;}
    .badge-new {background:#e50914;color:#fff;position:absolute;top:7px;left:7px;padding:2px 13px;border-radius:8px;font-size:.93em;}
    #modal-player{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(12,12,16,0.95);backdrop-filter:blur(10px);display:none;align-items:center;justify-content:center;z-index:5000;overflow-x:auto;}
    #modal-content{background:#222; border-radius:21px; padding:30px 12px 20px 12px; max-width:96vw;width:97vw; box-shadow:0 17px 49px #000a;position:relative;color:#fff;}
    #player{text-align:center;margin-bottom:17px;}
    #player iframe{width:100%;max-width:98vw;height:50vw;max-height:350px;min-height:170px;border-radius:13px;box-shadow:0 1.5px 13px #e5091440;}
    #close-btn{background:#e50914;color:#fff;border:none;border-radius:9px;padding:10px 13px;font-size:1em;cursor:pointer;font-weight:600;position:absolute;right:13px;top:13px;}
    #close-btn:hover{background:#bd070a;}
    #detail-title{font-size:1.24em;font-weight:700;margin:7px 0 7px 0;color:#ffe27a;text-shadow:0 2px 7px #111b;}
    #movie-detail, #detail-desc, #movie-detail *{color:#fff !important;}
    #detail-desc{font-size:1em;color:#e0e0e0!important;margin:5px 0;}
    #suggestion-title{font-size:1.07em;margin:14px 0 8px 0;color:#ffef79;}
    .suggest-row{display:flex;gap:14px;overflow-x:auto;}
    .suggest-card{width:88px;min-width:88px;border-radius:8px;overflow:hidden;background:#252527;box-shadow:0 1px 7px #0003;cursor:pointer;transition:transform .11s;}
    .suggest-card img{width:100%;aspect-ratio:2/3;object-fit:cover;}
    .suggest-card:hover{transform:scale(1.08);}
    .s-title{font-size:.96em;font-weight:600;padding:3px 2px 1px 2px;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#fff;}
    @media (max-width:700px){.movie-card{width:38vw;min-width:95px;}.movie-info{padding:10px;}}
    @media (max-width:550px){.movie-card{width:54vw;min-width:63px;}#modal-content{padding:7px 1vw;width:100vw;max-width:100vw;}#player iframe{height:34vw;min-height:125px;max-height:200px;}}
    footer{color:#bababa;text-align:center;padding:15px 0 7px 0;font-size:.97em;}
    a,a:visited{color:#ffe27a;}
  </style>
</head>
<body>
  <header>
    <h1>PHIM ONLINE</h1>
    <input type="search" id="search" placeholder="Tìm kiếm phim..."/>
    <select id="genres"><option value="">Tất cả thể loại</option></select>
  </header>
  <section class="hero">
    <div class="hero-info" id="hero-info">
      <div class="hero-title">Khám phá kho phim mới nhất 2025</div>
      <div class="hero-desc">Xem phim lẻ, phim bộ, hoạt hình, TV show cực nét miễn phí. Giao diện Việt hóa, lấy cảm hứng từ FPT Play, K+.</div>
      <button class="hero-btn" onclick="scrollToMain()">Xem ngay</button>
    </div>
  </section>
  <main id="movie-rows"></main>
  <div id="modal-player">
    <div id="modal-content">
      <button id="close-btn" onclick="closePlayer()">Đóng</button>
      <div id="player"></div>
      <div id="movie-detail"></div>
      <div id="suggestion-title"></div>
      <div class="suggest-row" id="suggest-row"></div>
    </div>
  </div>
  <footer>
    &copy; 2025 Phim Việt | Giao diện sáng, chữ nổi rõ ràng | Powered by Google Sheets/Drive 
  </footer>
  <script>
  const SHEET_ID = '15mFrve7Z-_zi_7AvSq3t9Nti1VjINVHCQDF7LRmP1QQ';
  const API_KEY = 'AIzaSyD5dWLgYZPu1_-AkwAaHPClGOOQ-Lq5EGI';
  const SHEET_RANGE = 'Sheet1!A1:K';
  let movieData = [], genres = new Set();
  let currentMovie = null;

  async function fetchMovies() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_RANGE}?key=${API_KEY}`;
    const res = await fetch(url); const data = await res.json();
    const rows = data.values || [];
    if(!rows.length) return movieData = [];
    const header = rows[0].map(h => h.trim().toLowerCase());
    const idxTitle    = header.findIndex(x => x==="tên phim");
    const idxDesc     = header.findIndex(x => x==="mô tả");
    const idxGenre    = header.findIndex(x => x==="thể loại");
    const idxDrive    = header.findIndex(x => x.includes("drive"));
    const idxPoster   = header.findIndex(x => x.includes("poster"));
    const idxYear     = header.findIndex(x => x==="năm");
    const idxRating   = header.findIndex(x => x.includes("điểm"));
    const idxID       = header.findIndex(x => x.includes("id"));
    movieData = rows.slice(1).map(row => ({
      title:  row[idxTitle]  || "",
      desc:   row[idxDesc]   || "",
      genre:  row[idxGenre]  || "",
      drive:  row[idxDrive]  || "",
      poster: row[idxPoster] || "",
      year:   row[idxYear]   || "",
      rating: parseFloat(row[idxRating]||"0"),
      id:     row[idxID]     || "",
      isNew:  row[idxYear] && +row[idxYear] >= (new Date().getFullYear() - 1)
    })).filter(m => m.title && m.id);
    genres = new Set(movieData.map(m=>m.genre));
  }
  function renderGenres() {
    const sel = document.getElementById("genres");
    sel.innerHTML = '<option value="">Tất cả thể loại</option>' +
      Array.from(genres).map(g=>`<option value="${g}">${g}</option>`).join('');
  }
  function renderMovies() {
    let search = document.getElementById("search").value.trim().toLowerCase();
    let genreSel = document.getElementById("genres").value;
    let filtered = movieData.filter(m=>{
      return (!genreSel||m.genre===genreSel) &&
        (!search || m.title.toLowerCase().includes(search)||m.desc.toLowerCase().includes(search));
    });
    let container = document.getElementById("movie-rows");
    if (!filtered.length) {
      container.innerHTML = `<div class="row-title">Không tìm thấy phim nào.</div>`;
      return;
    }
    let hotGenres = [...genres].filter(g=>g).sort((a,b)=>filtered.filter(m=>m.genre==b).length-filtered.filter(m=>m.genre==a).length);
    let html = '';
    for (const g of hotGenres){
      const arr = filtered.filter(m=>m.genre==g);
      if(arr.length)
        html += `<div class="row-title">${g}</div>
        <div class="movie-row">${arr.map(m=>movieCard(m)).join('')}</div>`;
    }
    container.innerHTML = html;
  }
  function movieCard(m){
    return `
      <div class="movie-card" onclick="openPlayer('${m.id}'); event.stopPropagation();">
        ${m.isNew?'<div class="badge-new">MỚI</div>':''}
        <img class="movie-poster" src="${m.poster||'https://img.icons8.com/color/480/movie-projector.png'}" alt="${m.title}"/>
        <div class="movie-info">
          <div class="movie-title">${m.title}</div>
          <div class="movie-genre">${m.genre||'Khác'} | <span class="movie-year">${m.year||''}</span></div>
          ${m.rating ? `<div class="movie-rating">★ ${m.rating.toFixed(1)}/5</div>`:""}
          <div class="movie-desc">${m.desc?m.desc.slice(0,66)+(m.desc.length>66?"...":""):""}</div>
        </div>
      </div>`;
  }
  function openPlayer(id) {
    currentMovie = movieData.find(m=>m.id===id);
    if (!currentMovie) return;
    document.body.style.overflow="hidden";
    document.getElementById("modal-player").style.display = "flex";
    const fileId = currentMovie.drive && currentMovie.drive.match(/[-\w]{25,}/);
    const embedUrl = fileId ? `https://drive.google.com/file/d/${fileId}/preview` : "";
    document.getElementById("player").innerHTML = embedUrl
      ? `<iframe src="${embedUrl}" allow="autoplay" allowfullscreen style="width:100%;min-height:180px;max-width:99vw;height:43vw;max-height:320px;border-radius:13px;"></iframe>`
      : '<div>Không có video</div>';
    document.getElementById("movie-detail").innerHTML = `
      <h2 id="detail-title">${currentMovie.title}</h2>
      <div><b style="color:#ffe27a;">Thể loại:</b> ${currentMovie.genre||""} | <b style="color:#ffe27a;">Năm:</b> ${currentMovie.year||""} | ${currentMovie.rating?`<span style="color:#ffd400;">★ ${currentMovie.rating.toFixed(1)}/5</span>`:"Chưa có điểm"}</div>
      <div id="detail-desc">${currentMovie.desc||""}</div>
    `;
    renderSuggestion(currentMovie);
  }
  function renderSuggestion(movie){
    let suggest = movieData.filter(m=>m.genre===movie.genre && m.id!==movie.id);
    document.getElementById("suggestion-title").innerText = suggest.length?"Phim liên quan:":"";
    document.getElementById("suggest-row").innerHTML = suggest.map(m=>`
      <div class="suggest-card" onclick="openPlayer('${m.id}'); event.stopPropagation();">
        <img src="${m.poster||'https://img.icons8.com/color/480/movie-projector.png'}" />
        <div class="s-title">${m.title}</div>
      </div>`).join('');
  }
  function closePlayer() {
    document.getElementById("modal-player").style.display = "none";
    document.body.style.overflow="";
    document.getElementById("player").innerHTML="";
    document.getElementById("movie-detail").innerHTML="";
    document.getElementById("suggestion-title").innerHTML = "";
    document.getElementById("suggest-row").innerHTML = "";
    currentMovie = null;
  }
  function scrollToMain() {
    document.getElementById('movie-rows').scrollIntoView({behavior:'smooth'});
  }
  document.getElementById("search").addEventListener("input", renderMovies);
  document.getElementById("genres").addEventListener("change", renderMovies);
  window.onload = async function(){
    await fetchMovies();
    renderGenres();
    renderMovies();
  }
  </script>
</body>
</html>
