<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"/>
  <title>MovieHub ‚Äì Phim Google Drive Proxy</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes"/>
  <meta name="theme-color" content="#191a24"/>
  <meta name="description" content="MovieHub - web phim Google Drive giao di·ªán hi·ªán ƒë·∫°i, proxy nhanh, t·ªëi ∆∞u anime, mobile, ƒëƒÉng nh·∫≠p m∆∞·ª£t, hi·ªáu ·ª©ng ƒë·∫πp, animation n·ªïi b·∫≠t.">
  <link rel="icon" type="image/svg+xml" href="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a75fa0ae-d935-45d3-a56a-67182b3177fa.png">
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css"/>
  <style>
    :root{
      --bg-main:#1a1930;
      --accent:#e50914;
      --accent2:#ffe066;
      --modal-bg:#262243ee;
      --card-bg:#232748f5;
      --card-bg2:#18223aef;
      --avatar:#f3f6ec;
      --blur:#23203fa8;
      --shadow:0 8px 36px #321a4e48;
      --card-radius:27px;
      --masonry-gap:22px;
      --danger:#ff4052;
    }
    html,body{background:var(--bg-main);}
    body{font-family: 'Manrope', Arial, Verdana, sans-serif; color:#fff; margin:0; font-size:18px;}
    .container{max-width:1120px;margin:0 auto;padding:33px 5vw 88px 5vw;}
    header{display:flex;align-items:center;gap:16px;padding:18px 3vw 13px 2vw;background:linear-gradient(89deg,#191742 79%,#321335 111%);}
    .logo{height:44px;width:44px;margin-right:8px;box-shadow:0 2px 16px #e5091466;border-radius:100%;background:#ffe06616;}
    .title{font-size:clamp(1.35em,3vw,2.19em);font-weight:900;color:var(--accent);letter-spacing:0.04em;}
    .searchbox{flex:1 1 220px;max-width:330px;margin:0 18px 0 0;padding:12px 18px;border-radius:10px;border:none;background:#242858;font-size:1.05em;color:#eaedfd;outline:2px solid transparent;transition:.18s;}
    .searchbox:focus{outline:2px solid var(--accent2);background:#281728;}
    #genreFilter{padding:11px 19px;border-radius:8px;background:#241c38cc;color:#ffc;border:none;font-size:1em;}
    .btn{padding:11px 25px;font-weight:900;font-size:1.04em;border:none;border-radius:13px;background:var(--accent);color:#fff;box-shadow:0 6px 28px #d5091522;transition:.15s;cursor:pointer;}
    .btn:hover{background:#e52b41;}
    .btn:active{transform:scale(.975);}
    #themeToggle{margin-left:14px;transition:.3s;}
    .right{margin-left:auto;display:flex;gap:17px;}
    .avatar{background:var(--avatar);border-radius:50%;width:43px;height:43px;display:inline-block;box-shadow:0 2px 19px #afeea3c8;}
    .avatar:hover{transform:rotate(14deg) scale(1.1);}
    h2{margin:34px 0 26px 0;text-shadow:0 2px 12px #e5091436;font-size:clamp(1.15em,3vw,1.77em);}
    .slider-preview{overflow-x:auto;display:flex;gap:21px;margin:8px 0 19px 0;}
    .slider-preview img{height:97px;border-radius:14px;transition:box-shadow .16s;}
    .slider-preview img:hover{box-shadow:0 6px 21px #ffe066c7;}
    .masonry{column-count:3;column-gap:var(--masonry-gap);}
    @media(max-width:900px){.masonry{column-count:2;}.container{padding-left:2vw;padding-right:2vw;}}
    @media(max-width:550px){.masonry{column-count:1;}.container{padding-left:1vw;padding-right:1vw;}}
    .phimcard{background:linear-gradient(132deg,var(--card-bg) 80%,var(--card-bg2) 111%);border-radius:var(--card-radius);box-shadow:var(--shadow);margin-bottom:24px;transition:.22s cubic-bezier(.25,.8,.6,1);position:relative;break-inside:avoid;transform:scale(.99);}
    .phimcard.appear{animation:flyIn .62s cubic-bezier(.28,1.1,.38,1.06) forwards;}
    .phimcard:hover{transform:scale(1.041) translateY(-13px);box-shadow:0 18px 48px #e509144c,0 4px 32px #32182c80;}
    .phimimg{width:100%;aspect-ratio:2/3;object-fit:cover;border-top-left-radius:var(--card-radius);border-top-right-radius:var(--card-radius);}
    .phimtitle{font-size:1.13em;margin:15px 22px 7px 17px;font-weight:900;}
    .badge-new{display:inline-block;position:absolute;left:14px;top:16px;background:var(--accent);color:#fff;padding:3px 16px;border-radius:11px;font-weight:700;font-size:1em;box-shadow:0 2px 10px #fa555566;}
    .badge-locked{background:var(--danger);color:#fff;border-radius:10px;font-size:.97em;padding:2px 14px;position:absolute;right:19px;top:19px;font-weight:600;box-shadow:0 1px 9px #3214;}
    .phimdesc,.phimmeta,.phimcast{margin:2px 19px 3px 19px;font-size:.95em;}
    .phimdesc{color:#f9eec8;}
    .phimmeta{color:var(--accent2);}
    .phimcast{color:#c1fade;}
    .watchbtn{margin:13px 0 0 21px;padding:10px 27px;font-size:1em;box-shadow:0 1px 7px #19192260;}
    .watchbtn.locked{background:#454560;color:#daaeae;}
    /* ... ti·∫øp hi·ªáu ·ª©ng modal, player, toast, ripple, theme, footer ... */
    /* Modal v√† hi·ªáu ·ª©ng glass */
    .modal{position:fixed;inset:0;background:rgba(23,20,40,0.8);backdrop-filter:blur(13px) brightness(.97);display:flex;align-items:center;justify-content:center;z-index:9000;}
    .modalDriveCustom{background:linear-gradient(144deg,#23203c 88%,#232246 121%);border-radius:30px;box-shadow:0 12px 63px #15142575;padding:29px 22px 19px 23px;max-width:510px;width:99vw;max-height:98vh;position:relative;}
    .modalDriveCustom input{width:95%;margin-bottom:14px;border-radius:11px;border:none;padding:13px;font-size:1.07em;background:#232a35;color:#fff;}
    .errmsg{color:#ff4161;font-size:1em;font-weight:700;margin-left:2px;}
    .closebtn2{position:absolute;right:13px;top:13px;background:var(--accent);color:var(--accent2);border:none;border-radius:13px;padding:9px 14px;font-size:1.19em;font-weight:900;cursor:pointer;z-index:2;box-shadow:0 2px 7px #ffe06699;}
    .movie-player-plyr{display:none;margin-bottom:15px;}
    .movie-player-iframe{display:none;margin-bottom:14px;}
    .modalDriveCustom.show-plyr .movie-player-plyr{display:block;}
    .modalDriveCustom.show-drive .movie-player-iframe{display:block;}
    .plyr{border-radius:16px;box-shadow:0 8px 29px #0009;}
    .watermark-logo{position:absolute;right:20px;bottom:22px;opacity:.13;z-index:5;user-select:none;height:59px;width:auto;max-width:22vw;}
    .player-toolbar{display:flex;align-items:center;justify-content:space-between;margin-top:15px;}
    .btnshare{background:#fff;color:var(--accent);font-weight:900;font-size:1em;padding:8px 13px;border-radius:9px;transition:.15s;}
    .btnshare:hover{background:var(--accent2);color:#151;}
    #playerFields{margin:21px 2px 0 5px;line-height:1.7;}
    /* Toast, loader, ripple, hi·ªáu ·ª©ng animation */
    .toast{position:fixed;right:24px;bottom:19px;z-index:39000;background:linear-gradient(90deg,#191b20 80%,#ffe066 102%);color:#e50914;padding:17px 26px 14px 26px;border-radius:15px;font-size:1.12em;box-shadow:0 3px 27px #2222;display:none;font-weight:800;}
    #globalLoading{display:flex;align-items:center;justify-content:center;position:fixed;inset:0;z-index:99999;background:#15122c;transition:.37s;opacity:1;}
    #globalLoading.done{opacity:0;pointer-events:none;}
    #globalLoading .spinner{width:41px;height:41px;border-radius:50%;border:7px solid #ffe066;border-top:7px solid #e50914;animation:spin1 .79s infinite linear;margin-right:10px;}
    @keyframes spin1{to{transform:rotate(360deg)}}
    @keyframes flyIn{0%{opacity:0;transform:translateY(29px) scale(.92);}100%{opacity:1;transform:translateY(0) scale(1);}}
    .ripple{position:absolute;pointer-events:none;border-radius:50%;background:var(--accent2)22;transform:scale(.76);animation:rippleAnim .91s linear;}
    @keyframes rippleAnim{to{opacity:0;transform:scale(2.6);}}
    .footer-moviehub{background:#1a1a24;color:#ecdcbc;text-align:center;padding:17px 4vw 13px 4vw;margin-top:44px;font-size:1.07em;}
    .footer-logo{height:29px;opacity:.97;}
  </style>
</head>
<body>
<div id="globalLoading"><div class="spinner"></div>ƒêang t·∫£i d·ªØ li·ªáu phim...</div>
<header>
  <img class="logo" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a75fa0ae-d935-45d3-a56a-67182b3177fa.png" alt="MovieHub Logo"/>
  <span class="title">MovieHub</span>
  <input class="searchbox" id="quickSearch" placeholder="T√¨m phim/T√¨m di·ªÖn vi√™n..."/>
  <select id="genreFilter"><option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option></select>
  <button id="themeToggle" class="btn" onclick="toggleTheme()" aria-label="ƒê·ªïi theme">üåô</button>
  <div class="right">
    <span id="userPanel"></span>
    <button id="loginBtn" class="btn" onclick="showLogin()" style="margin-left:8px;">ƒêƒÉng nh·∫≠p</button>
    <button id="logoutBtn" class="btn" onclick="logoutUser()" style="display:none;margin-left:8px;">ƒêƒÉng xu·∫•t</button>
  </div>
</header>
<div class="container" role="main">
  <h2>MovieHub ‚Äì Giao di·ªán hi·ªán ƒë·∫°i, t·ªëc ƒë·ªô cao, animation n·ªïi b·∫≠t, xem phim c·ª±c m∆∞·ª£t</h2>
  <div class="slider-preview" id="sliderPreview"></div>
  <div id="genreRows" class="masonry"></div>
</div>
<div id="toastMsg" class="toast" aria-live="assertive"></div>
<div id="loginModal" class="modal" aria-modal="true"><div class="modalDriveCustom" style="max-width:420px;">
  <button class="closebtn2" onclick="closeLogin()" aria-label="ƒê√≥ng">&times;</button>
  <div style="color:#ffe066;margin:15px 3px 20px 3px;font-size:1.14em;font-weight:800;">ƒêƒÉng nh·∫≠p th√†nh vi√™n MovieHub</div>
  <input id="loginUser" placeholder="T√†i kho·∫£n..." autocomplete="username"/>
  <input id="loginPass" type="password" placeholder="M·∫≠t kh·∫©u..." autocomplete="current-password"/>
  <button class="btn" onclick="doLogin()" style="width:100%">ƒêƒÉng nh·∫≠p</button>
  <div class="errmsg" id="loginErr" style="display:none;margin-top:12px;"></div>
</div></div>
<div id="playerModal" class="modal" style="display:none;" aria-modal="true"><div class="modalDriveCustom">
  <button class="closebtn2" onclick="closePlayer()" aria-label="ƒê√≥ng player phim">&times;</button>
  <div class="movie-player-plyr" style="display:none"><video id="plyrVideo" controls poster="" style="width:100%;" crossorigin="anonymous"></video></div>
  <div class="movie-player-iframe" style="display:none"><iframe id="driveFrame" allowfullscreen allow="autoplay; fullscreen" style="width:100%;min-height:210px;border-radius:19px;background:#151823;border:none;"></iframe></div>
  <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a75fa0ae-d935-45d3-a56a-67182b3177fa.png" class="watermark-logo" alt="MovieHub Watermark"/>
  <div class="player-toolbar"><span id="playerTitle" class="player-title"></span><button class="btnshare" onclick="copyPlayerLink()" style="margin-left:17px;">üìã Link phim</button></div>
  <div id="playerFields"></div>
</div></div>
<footer class="footer-moviehub">
  <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a75fa0ae-d935-45d3-a56a-67182b3177fa.png" alt="MovieHub Logo" class="footer-logo"/>
  <div class="footer-content">MovieHub &copy; 2025 ‚Äì Giao di·ªán phim proxy m∆∞·ª£t, b·∫£n quy·ªÅn thu·ªôc MovieHub.vn</div>
</footer>
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<script>
const SHEET_ID = '15mFrve7Z-_zi_7AvSq3t9Nti1VjINVHCQDF7LRmP1QQ';
const API_KEY = 'AIzaSyD5dWLgYZPu1_-AkwAaHPClGOOQ-Lq5EGI';
const SHEET_RANGE = 'Sheet1!A1:Z';
const USERS_RANGE = 'Users!A2:C';
let phimList=[], genresSet=new Set(), loggedUser = false, userList=[], sessionUser=null;

// Hi·ªáu ·ª©ng toast t·ª± ƒë·ªông
function showToast(msg,dur=2100){
  let t=document.getElementById('toastMsg');
  t.textContent=msg;
  t.style.display="block";
  t.style.transform="translateY(30px)";
  setTimeout(()=>t.style.transform="translateY(0)",30);
  setTimeout(()=>t.style.display="none",dur);
}
// Theme transition
function toggleTheme(){
  const body=document.body;
  body.style.transition="background .2s";
  if(body.classList.contains("lightmode")){
    body.classList.remove("lightmode");
    document.getElementById('themeToggle').innerText='üåô';
    localStorage.setItem("moviehub_theme",'dark');
  }else{
    body.classList.add("lightmode");
    document.getElementById('themeToggle').innerText='‚òÄÔ∏è';
    localStorage.setItem("moviehub_theme",'light');
  }
}
function playRipple(el,e){
  const r=document.createElement('span');
  r.className='ripple';
  const rect=el.getBoundingClientRect(),
    size=Math.max(rect.width,rect.height)*.66,
    x=e.clientX-rect.left-size/2,
    y=e.clientY-rect.top-size/2;
  r.style.cssText=`width:${size}px;height:${size}px;top:${y}px;left:${x}px;`;
  el.appendChild(r);
  setTimeout(()=>el.removeChild(r),740);
}
function showLogin(){
  document.getElementById('loginModal').style.display='flex';
  document.getElementById('loginUser').value='';
  document.getElementById('loginPass').value='';
  document.getElementById('loginErr').style.display='none';
}
function closeLogin(){document.getElementById('loginModal').style.display='none';}
function doLogin(){
  let user=document.getElementById('loginUser').value.trim(),
      pass=document.getElementById('loginPass').value.trim();
  let found=userList.find(u=>u.user===user&&u.pass===pass);
  if(found){
    loggedUser=true;sessionUser=user;
    closeLogin();renderPhim();showToast('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!');
    document.getElementById('loginBtn').style.display="none";
    document.getElementById('logoutBtn').style.display="inline-block";
    document.getElementById('userPanel').innerHTML = `<span class="avatar" title="T√†i kho·∫£n: ${user}">${user[0].toUpperCase()}</span>`;
  }else{
    document.getElementById('loginErr').innerText='Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!';
    document.getElementById('loginErr').style.display='block';
  }
}
function logoutUser(){
  loggedUser=false;sessionUser=null;
  document.getElementById('userPanel').innerHTML='';
  document.getElementById('loginBtn').style.display="inline-block";
  document.getElementById('logoutBtn').style.display="none";
  showToast("ƒê√£ ƒëƒÉng xu·∫•t!");renderPhim();
}
async function fetchUsers(){
  const url=`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${USERS_RANGE}?key=${API_KEY}`;
  let res=await fetch(url);let data=await res.json();
  userList=(data.values||[]).map(r=>({user:r[0],pass:r[1],role:r[2]}));
}
function extractFileId(link){
  let m=link.match(/file\/d\/([a-zA-Z0-9_-]+)/)
     ||link.match(/[?&]id=([a-zA-Z0-9_-]+)/)
     ||link.match(/^([a-zA-Z0-9_-]{25,})$/);
  return m?m[1]:null;
}
async function getGdPlayerProxyMp4(fileId){
  try{
    const api=`https://gdplayer.vip/api/video?file_id=${fileId}`;
    const res=await fetch(api);if(!res.ok)return null;
    const dt=await res.json();return dt.file;
  }catch(e){return null;}
}
async function showPhim(_id){
  let m=phimList.find(m=>encodeURIComponent(m.id)===_id);
  if(!m) return showToast("Kh√¥ng t√¨m th·∫•y phim!");
  window.location.hash = "id=" + encodeURIComponent(m.id); // C·∫≠p nh·∫≠t URL ƒë·ªông

  document.getElementById('playerTitle').innerText=m.title;
  document.getElementById('playerFields').innerHTML=[
    `<div><b>M√¥ t·∫£:</b> ${m.desc||''}</div>`,
    `<div><b>NƒÉm:</b> ${m.year||''}</div>`,
    `<div><b>Th·ªÉ lo·∫°i:</b> ${m.genre||''}</div>`,
    m.cast?`<div><b>Di·ªÖn vi√™n/ƒê·∫°o di·ªÖn:</b> ${m.cast}</div>`:'',
    m.drive?`<div><b>Link Google Drive:</b> <a href="${m.drive}" target="_blank" style="color:#ffe066;">M·ªü link g·ªëc</a></div>`:''
  ].join('');
  let fileId=extractFileId(m.drive),
  modal=document.querySelector('.modalDriveCustom'),
  plyrWrap=document.querySelector('.movie-player-plyr'),
  ifrWrap=document.querySelector('.movie-player-iframe'),
  plyr=document.getElementById('plyrVideo'),
  ifr=document.getElementById('driveFrame');
  plyrWrap.style.display=ifrWrap.style.display="none";
  if(m.special&&!loggedUser){
    showToast("Phim n√†y y√™u c·∫ßu ƒëƒÉng nh·∫≠p.");closePlayer();showLogin();return;
  }
  document.getElementById('playerModal').style.display='flex';

  if(fileId){
    getGdPlayerProxyMp4(fileId).then(res=>{
      if(res){
        if(window.playerPlyr) try{window.playerPlyr.destroy();}catch(e){}
        ifrWrap.style.display="none";plyrWrap.style.display="block";plyr.poster=m.poster||'';plyr.src=res;
        window.playerPlyr=new Plyr('#plyrVideo',{controls:['play-large','play','progress','current-time','duration','mute','volume','settings','fullscreen'], settings:['quality','speed','loop'],ratio:'16:9',fullscreen:{ enabled:true, fallback:true, iosNative:true } });
        playerPlyr.source={type:"video",sources:[{src:res,type:'video/mp4',size:720}]};
        modal.classList.remove('show-drive');modal.classList.add('show-plyr');
      }else{
        plyrWrap.style.display="none";ifrWrap.style.display="block";
        ifr.src=`https://drive.google.com/file/d/${fileId}/preview`;
        modal.classList.remove('show-plyr');modal.classList.add('show-drive');
      }
    }).catch(()=>{
      plyrWrap.style.display="none";ifrWrap.style.display="block";
      ifr.src=`https://drive.google.com/file/d/${fileId}/preview`;
      modal.classList.remove('show-plyr');modal.classList.add('show-drive');
    });
  }else{
    plyrWrap.style.display="none";ifrWrap.style.display="block";
    ifr.src=m.drive;
    modal.classList.remove('show-plyr');modal.classList.add('show-drive');
  }
}
function closePlayer(){
  document.getElementById('driveFrame').src='';
  if(window.playerPlyr)window.playerPlyr.pause();
  document.getElementById('playerModal').style.display='none';
  document.querySelector('.modalDriveCustom').classList.remove('show-drive','show-plyr');
  history.replaceState(null,null,window.location.pathname);
}
function copyPlayerLink(){
  let link=window.location.origin+window.location.pathname+window.location.hash;
  navigator.clipboard.writeText(link);showToast("ƒê√£ sao ch√©p link phim: "+link);
}
async function fetchPhim(){
  let url=`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_RANGE}?key=${API_KEY}`;
  let res=await fetch(url);let data=await res.json();let rows=data.values||[],
  header=rows[0],idx=n=>header.findIndex(x=>x&&x.trim().toLowerCase()===n);
  phimList=rows.slice(1).map(row=>({
    title:row[idx('t√™n phim')]||'',desc:row[idx('m√¥ t·∫£')]||'',genre:row[idx('th·ªÉ lo·∫°i')]||'',
    year:row[idx('nƒÉm')]||'',id:row[idx('id')]||'',drive:row[idx('link google drive')]||'',
    poster:row[idx('link poster')]||'',special:(row[idx('special')]||'').trim().toLowerCase()==='yes',
    cast:row[idx('di·ªÖn vi√™n/ƒë·∫°o di·ªÖn')]||'',isNew:row[idx('nƒÉm')]&&+row[idx('nƒÉm')]>=((new Date()).getFullYear()-1)
  })).filter(m=>m.title);genresSet=new Set(phimList.map(m=>m.genre).filter(g=>g&&g!==''));updateGenreOptions();renderPhim();renderSliderPreview();
}
function updateGenreOptions(){
  let sel=document.getElementById("genreFilter");
  sel.innerHTML=`<option value=\"\">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>${Array.from(genresSet).map(g=>`<option value=\"${g}\">${g}</option>`).join('')}`;
}
function renderPhim(){
  const sel=document.getElementById("genreFilter"),
  search=document.getElementById("quickSearch").value.trim().toLowerCase(),
  selected=sel.value||'';let phimTheoGenre={};
  phimList.filter(m=>
    (!selected||m.genre===selected)
    &&(!search||m.title.toLowerCase().includes(search)||m.genre.toLowerCase().includes(search)
        ||m.desc.toLowerCase().includes(search)||(m.cast||'').toLowerCase().includes(search)))
    .forEach(m=>(phimTheoGenre[m.genre]=phimTheoGenre[m.genre]||[]).push(m));
  let html='';for(const genre of Object.keys(phimTheoGenre)){
    html+=`<div class="row-title">${genre}</div><div class="phimlist">${
    phimTheoGenre[genre].map(m=>`<div class="phimcard" onclick="showPhim('${encodeURIComponent(m.id)}')" onmousedown="playRipple(this,event)">
      <span class="badge-new" style="${m.isNew?'':'display:none'}">M·ªöI</span>
      ${m.special?'<span class="badge-locked">Kh√≥a</span>':''}
      <img class="phimimg" src="${m.poster||'https://img.icons8.com/color/480/movie-projector.png'}" alt="Phim: ${m.title}">
      <div class="phimtitle">${m.title}</div>
      <div class="phimmeta">Th·ªÉ lo·∫°i: ${m.genre||'Ch∆∞a r√µ'} | NƒÉm: ${m.year||''}</div>
      <div class="phimdesc">${m.desc||''}</div>
      ${m.cast?`<div class="phimcast">Di·ªÖn vi√™n/ƒê·∫°o di·ªÖn: ${m.cast}</div>`:''}
      <button class="btn watchbtn${m.special?' locked':''}" tabindex="-1" onclick="event.stopPropagation();showPhim('${encodeURIComponent(m.id)}')">${m.special?'Ch·ªâ th√†nh vi√™n':'Xem phim'}</button>
    </div>`).join('')}</div>`;
  }
  document.getElementById('genreRows').innerHTML=html;
  setTimeout(()=>{document.querySelectorAll('.phimcard').forEach((el,i)=>setTimeout(()=>el.classList.add('appear'),63*i));},16);
}
function renderSliderPreview(){
  let arr=[...phimList], k=Math.min(arr.length,10), out=[];
  while(k-- && arr.length){
    let r=Math.floor(Math.random()*arr.length);out.push(arr[r]);arr.splice(r,1);
  }
  document.getElementById('sliderPreview').innerHTML=out.map(m=>
    `<img src="${m.poster||'https://img.icons8.com/color/480/movie-projector.png'}" title="${m.title}" onclick="showPhim('${encodeURIComponent(m.id)}')">`
  ).join('');
}
window.onload=async()=>{
  document.getElementById('globalLoading').classList.remove('done');await fetchUsers();await fetchPhim();
  let th=localStorage.getItem("moviehub_theme");
  if(th==="light"){document.body.classList.add("lightmode");document.getElementById('themeToggle').innerText='‚òÄÔ∏è';}
  else{document.getElementById('themeToggle').innerText='üåô';}
  setTimeout(()=>{document.getElementById('globalLoading').classList.add('done');},99);
  if(location.hash.startsWith("#id=")){let id=decodeURIComponent(location.hash.slice(4));showPhim(encodeURIComponent(id));}
  document.getElementById('loginBtn').style.display="inline-block";
  document.getElementById('logoutBtn').style.display="none";
}
window.addEventListener("hashchange",()=>{
  if(location.hash.startsWith("#id=")){
    let id=decodeURIComponent(location.hash.slice(4));showPhim(encodeURIComponent(id));
  } else closePlayer();
});
document.getElementById("genreFilter").addEventListener("change",renderPhim);
document.getElementById("quickSearch").addEventListener("input",()=>{renderPhim();});
</script>
</body>
</html>
