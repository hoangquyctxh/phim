<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"/>
  <title>MovieHub - Trang xem phim online miễn phí</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/>
  <meta name="description" content="MovieHub - Trang phim trực tuyến: Xem phim lẻ, phim bộ, hoạt hình, TV show, anime chất lượng cao, giao diện đẹp, chia sẻ link dễ dàng, trải nghiệm mượt trên mọi thiết bị!"/>
  <style>
    html,body {min-height:100vh; margin:0; padding:0; background:#181818;}
    body { color:#fff; font-family:'Segoe UI',Arial,sans-serif;}
    * { box-sizing: border-box; }
    ::-webkit-scrollbar { width: 8px; background: #232323;}
    ::-webkit-scrollbar-thumb { background: #e50914; border-radius:5px;}
    header {position:sticky;top:0;z-index:3000;background:rgba(32,32,32,.99);display:flex;align-items:center;padding:9px 6vw 8px 3vw;gap:18px;box-shadow:0 2px 14px #1114;}
    .logo-moviehub { display:flex; align-items:center; gap:9px; }
    .logo-moviehub img {height:38px; width:auto;display:block;}
    .logo-moviehub span { font-size:1.6em;font-weight:700;color:#e50914;letter-spacing:.5px;text-shadow:0 2px 12px #000a;}
    #search,#genres{padding:8px 8px;font-size:1em;border-radius:7px;border:none;background:#232323;color:#fff;}
    #search:focus,#genres:focus{box-shadow:0 2px 9px #e5091442;}
    #search{min-width:145px;}
    #genres{min-width:100px;}
    main{width:100vw;}
    .row-title{font-size:1.09em;color:#ffef79;margin:28px 20px 10px 18px;font-weight:700;letter-spacing:.45px;}
    .movie-row{display:flex;overflow-x:auto;gap:21px;padding:0 2vw 15px 2vw;scroll-behavior:smooth;}
    .movie-card{width:162px;min-width:162px;background:linear-gradient(120deg,#222 82%,#191818 100%);border-radius:12px;overflow:hidden;margin-bottom:14px;box-shadow:0 4px 16px #0006;cursor:pointer;position:relative;transition:transform .15s,box-shadow .14s;}
    .movie-card:hover{transform:scale(1.05) translateY(-3px);box-shadow:0 16px 33px #e5091433;}
    .movie-poster{width:100%;aspect-ratio:2/3;object-fit:cover;background:#222;display:block;}
    .movie-info{padding:9px 12px 10px 12px;min-height:49px;}
    .movie-title{font-size:1em;font-weight:600;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#fff;}
    .movie-genre,.movie-year{font-size:0.97em;opacity:.82;color:#fffd;}
    .movie-rating{color:#fadb3a;font-weight:bold;font-size:1.01em;}
    .movie-desc{color:#e2e2e2;font-size:.93em;margin-top:4px;}
    .badge-new {background:#e50914;color:#fff;position:absolute;top:7px;left:7px;padding:2px 13px;border-radius:8px;font-size:.88em;}
    .badge-locked{background:#bbb;color:#222;position:absolute;top:7px;right:7px;padding:2px 10px 2px 8px;border-radius:7px;font-size:.91em;border:1.5px solid #888;}
    #modal-player{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(12,12,16,0.97);backdrop-filter:blur(12px);display:none;align-items:center;justify-content:center;z-index:5000;}
    #modal-content{background:#232323;border-radius:15px;padding:14px 7px 10px 7px;max-width:98vw;width:98vw;box-shadow:0 10px 33px #000a;position:relative;color:#fff;}
    #player{text-align:center;margin-bottom:10px;}
    #player iframe{width:100%;max-width:98vw;height:43vw;max-height:250px;min-height:120px;border-radius:11px;box-shadow:0 0.6px 10px #e5091445;}
    #close-btn{background:#e50914;color:#fff;border:none;border-radius:8px;padding:8px 11px;font-size:1em;cursor:pointer;font-weight:600;position:absolute;right:8px;top:8px;}
    #close-btn:hover{background:#bd070a;}
    #detail-title{font-size:1.13em;font-weight:700;margin:4px 0 6px 0;color:#ffe27a;}
    #movie-detail, #detail-desc, #movie-detail *{color:#fff !important;}
    #detail-desc{font-size:0.98em;color:#e0e0e0;margin:6px 0;}
    .share-btn{float:right;margin-top:-3px;padding:6px 14px;background:#ffe066;color:#111;font-size:.93em;font-weight:bold;border:none;border-radius:11px;cursor:pointer;}
    .share-btn:hover{background:#edb800;}
    #suggestion-title{font-size:.96em;margin:10px 0 7px 0;color:#ffef79;}
    .suggest-row{display:flex;gap:10px;overflow-x:auto;}
    .suggest-card{width:70px;min-width:70px;border-radius:6px;overflow:hidden;background:#252527;box-shadow:0 1px 7px #0003;cursor:pointer;transition:transform .11s;}
    .suggest-card img{width:100%;aspect-ratio:2/3;object-fit:cover;}
    .suggest-card:hover{transform:scale(1.06);}
    .s-title{font-size:.89em;font-weight:600;padding:2px 1px 1px 1px;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    #moviehub-popup {
      display:none; position:fixed; right:11px; bottom:14px; z-index:8000; align-items:center; gap:9px; background:rgba(28,28,32,0.97);
      padding:8px 11px 8px 6px; border-radius:12px; box-shadow:0 6px 23px #000b; backdrop-filter:blur(2px);
      animation: popin 0.68s; transition: opacity 0.45s;
    }
    #login-modal{display:none;position:fixed;z-index:9000;left:0;top:0;width:100vw;height:100vh;background:#111a;backdrop-filter:blur(2px);align-items:center;justify-content:center;}
    #login-modal-box{background:#262626;padding:31px 25px 24px 25px;border-radius:15px;box-shadow:0 2px 40px #000b;font-size:1.09em;min-width:210px;text-align:center;}
    #login-modal-box input{padding:8px;font-size:1em;margin-bottom:7px;width:92%;max-width:270px;}
    #login-modal-box button{padding:8px 21px;font-weight:600;}
    #login-error{color:#e50914;margin-top:10px;display:none;}
    #logout-btn{background:none;color:#ffe066;border:none;font-size:.98em;margin-left:13px;cursor:pointer;}
    #logout-btn:hover{color:#e50914;}
    @keyframes popin {
      0% { transform:translateY(32px) scale(0.93); opacity:0; }
      60%{ transform:translateY(-7px) scale(1.07);opacity:1;}
      100%{ transform:translateY(0) scale(1); opacity:1;}
    }
    @media (max-width:650px){
      header{gap:2vw;padding:7px 2vw 7px 2vw;}
      .logo-moviehub img{height:27px;}
      .logo-moviehub span{font-size:1.11em;}
      #search{min-width:24vw;font-size:.99em;}
      #genres{min-width:24vw;font-size:.99em;}
      .movie-card {width:41vw; min-width:68px;}
      .movie-info{padding:8px;}
      #modal-content{padding:5px 2vw 4px 2vw;}
      #player iframe{height:36vw;min-height:72px;max-height:140px;}
      #moviehub-popup img{height:20px;}
      #moviehub-popup span{font-size:.93em;}
      #login-modal-box{padding:23px 7vw 20px 7vw;}
    }
    @media (max-width:440px){
      main{padding-bottom:25vw;}
      #moviehub-popup{padding:6px 6px 6px 4px;right:7px;bottom:7px;}
      .movie-card{width:54vw;min-width:58px;}
    }
    footer{color:#bababa;text-align:center;padding:15px 0 7px 0;font-size:.97em;}
    a,a:visited{color:#ffe27a;}
  </style>
</head>
<body>
  <header>
    <div class="logo-moviehub">
      <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a75fa0ae-d935-45d3-a56a-67182b3177fa.png" alt="MovieHub Logo" style="height:38px;width:auto;display:block;">
      <span>MovieHub</span>
    </div>
    <input type="search" id="search" placeholder="Tìm kiếm phim..."/>
    <select id="genres"><option value="">Tất cả thể loại</option></select>
    <button id="logout-btn" style="display:none" onclick="logoutMoviehub()">Thoát</button>
  </header>
  <section class="hero">
    <div class="hero-info" id="hero-info">
      <div class="hero-title">MovieHub - Xem phim Online miễn phí</div>
      <div class="hero-desc">Phim lẻ, phim bộ, hoạt hình, TV show, anime chất lượng cao. Giao diện hiện đại. Chia sẻ link từng phim dễ dàng!</div>
      <button class="hero-btn" onclick="scrollToMain()">Xem ngay</button>
    </div>
  </section>
  <main id="movie-rows"></main>
  <div id="modal-player">
    <div id="modal-content">
      <button id="close-btn" onclick="closePlayer()">Đóng</button>
      <div id="player"></div>
      <div id="movie-detail"></div>
      <div id="suggestion-title"></div>
      <div class="suggest-row" id="suggest-row"></div>
    </div>
  </div>
  <!-- Popup logo thông báo -->
  <div id="moviehub-popup">
    <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a75fa0ae-d935-45d3-a56a-67182b3177fa.png" alt="MovieHub logo" style="height:21px;width:auto;display:inline-block;vertical-align:middle;margin-right:6px;">
    <span style="font-size:1em;font-weight:500;color:#fff;vertical-align:middle;">
      Bạn đang xem phim tại <b style="color:#e50914;font-weight:700;font-size:1.01em;vertical-align:middle;">MovieHub</b>
    </span>
  </div>
  <div id="login-modal" style="display:none;position:fixed;z-index:9000;left:0;top:0;width:100vw;height:100vh;background:#111a;backdrop-filter:blur(2px);align-items:center;justify-content:center;">
    <div style="background:#262626;padding:32px 20px 18px 20px;border-radius:13px;box-shadow:0 2px 40px #000b;min-width:210px;font-size:1.12em;text-align:center;">
      <b>Đăng nhập để xem phim đặc biệt</b><br><br>
      <input id="user" placeholder="Tài khoản"><br>
      <input type="password" id="pass" placeholder="Mật khẩu"><br>
      <button onclick="doLoginMoviehub()">Đăng nhập</button>
      <div id="login-error" style="color:#e50914;margin-top:10px;display:none;">Sai tài khoản hoặc mật khẩu.</div>
    </div>
  </div>
  <footer>
    &copy; 2025 MovieHub. Trang xem phim online miễn phí – Giao diện đẹp, chia sẻ link từng phim dễ dàng.
  </footer>
  <script>
  const SHEET_ID = '15mFrve7Z-_zi_7AvSq3t9Nti1VjINVHCQDF7LRmP1QQ';
  const API_KEY = 'AIzaSyD5dWLgYZPu1_-AkwAaHPClGOOQ-Lq5EGI';
  const SHEET_RANGE = 'Sheet1!A1:K';
  const USERS_RANGE = 'Users!A2:C';
  let movieData = [], genres = new Set();
  let userList = [];
  let currentMovie = null;

  async function fetchUsers() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${USERS_RANGE}?key=${API_KEY}`;
    const res = await fetch(url); const data = await res.json();
    userList = (data.values||[]).map(row=>({user:String(row[0]||"").trim(), pass:String(row[1]||"").trim(), role:row[2]}));
  }
  async function fetchMovies() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_RANGE}?key=${API_KEY}`;
    const res = await fetch(url); const data = await res.json();
    const rows = data.values || [];
    if(!rows.length) return movieData = [];
    const header = rows[0].map(h => h.trim().toLowerCase());
    const idxTitle    = header.findIndex(x => x==="tên phim");
    const idxDesc     = header.findIndex(x => x==="mô tả");
    const idxGenre    = header.findIndex(x => x==="thể loại");
    const idxDrive    = header.findIndex(x => x.includes("drive"));
    const idxPoster   = header.findIndex(x => x.includes("poster"));
    const idxYear     = header.findIndex(x => x==="năm");
    const idxRating   = header.findIndex(x => x.includes("điểm"));
    const idxID       = header.findIndex(x => x.includes("id"));
    const idxSpecial  = header.findIndex(x => x.includes("special"));
    movieData = rows.slice(1).map(row => ({
      title:  row[idxTitle]  || "",
      desc:   row[idxDesc]   || "",
      genre:  row[idxGenre]  || "",
      drive:  row[idxDrive]  || "",
      poster: row[idxPoster] || "",
      year:   row[idxYear]   || "",
      rating: parseFloat(row[idxRating]||"0"),
      id:     row[idxID]     || "",
      special: !!(row[idxSpecial] && String(row[idxSpecial]).toLowerCase()==='yes' ),
      isNew:  row[idxYear] && +row[idxYear] >= (new Date().getFullYear() - 1)
    })).filter(m => m.title && m.id);
    genres = new Set(movieData.map(m=>m.genre));
  }
  function renderGenres() {
    const sel = document.getElementById("genres");
    sel.innerHTML = '<option value="">Tất cả thể loại</option>' +
      Array.from(genres).map(g=>`<option value="${g}">${g}</option>`).join('');
  }
  function renderMovies() {
    let search = document.getElementById("search").value.trim().toLowerCase();
    let genreSel = document.getElementById("genres").value;
    let filtered = movieData.filter(m=>{
      return (!genreSel||m.genre===genreSel) &&
        (!search || m.title.toLowerCase().includes(search)||m.desc.toLowerCase().includes(search));
    });
    let container = document.getElementById("movie-rows");
    if (!filtered.length) {
      container.innerHTML = `<div class="row-title">Không tìm thấy phim nào.</div>`;
      return;
    }
    let hotGenres = [...genres].filter(g=>g).sort((a,b)=>filtered.filter(m=>m.genre==b).length-filtered.filter(m=>m.genre==a).length);
    let html = '';
    for (const g of hotGenres){
      const arr = filtered.filter(m=>m.genre==g);
      if(arr.length)
        html += `<div class="row-title">${g}</div>
        <div class="movie-row">${arr.map(m=>movieCard(m)).join('')}</div>`;
    }
    container.innerHTML = html;
  }
  function movieCard(m){
    return `
      <div class="movie-card" onclick="openPlayer('${m.id}'); event.stopPropagation();">
        ${m.isNew?'<div class="badge-new">MỚI</div>':''}
        ${m.special?'<div class="badge-locked">Khoá</div>':''}
        <img class="movie-poster" src="${m.poster||'https://img.icons8.com/color/480/movie-projector.png'}" alt="${m.title}"/>
        <div class="movie-info">
          <div class="movie-title">${m.title}</div>
          <div class="movie-genre">${m.genre||'Khác'} | <span class="movie-year">${m.year||''}</span></div>
          ${m.rating ? `<div class="movie-rating">★ ${m.rating.toFixed(1)}/5</div>`:""}
          <div class="movie-desc">${m.desc?m.desc.slice(0,66)+(m.desc.length>66?"...":""):""}</div>
        </div>
      </div>`;
  }
  function showPopupMovieHub() {
    let popup = document.getElementById('moviehub-popup');
    popup.style.display = 'flex';
    popup.style.opacity = '1';
    clearTimeout(window.moviehubPopupTimeout);
    window.moviehubPopupTimeout = setTimeout(()=>{
      popup.style.opacity = '0';
      setTimeout(()=>popup.style.display='none', 600);
    }, 6000);
  }
  function showLoginModal() {
    document.getElementById('login-modal').style.display = 'flex';
    document.getElementById('login-error').style.display = 'none';
    document.getElementById('user').value='';
    document.getElementById('pass').value='';
    setTimeout(()=>document.getElementById('user').focus(), 100);
  }
  function doLoginMoviehub() {
    const u = document.getElementById('user').value.trim();
    const p = document.getElementById('pass').value.trim();
    let found = userList.find(row=>row.user===u && row.pass===p);
    if(found){
      localStorage.setItem("user_logged_in",'yes');
      localStorage.setItem("user_name",found.user);
      document.getElementById('login-modal').style.display='none';
      document.getElementById('logout-btn').style.display='inline-block';
      if(currentMovie && currentMovie.id) openPlayer(currentMovie.id);
    } else {
      document.getElementById('login-error').style.display='block';
    }
  }
  function logoutMoviehub(){
    localStorage.removeItem("user_logged_in");
    localStorage.removeItem("user_name");
    document.getElementById('logout-btn').style.display='none';
    alert('Đã đăng xuất!');
  }
  function openPlayer(id) {
    currentMovie = movieData.find(m=>m.id===id);
    if (!currentMovie) return;
    if(currentMovie.special && !localStorage.getItem("user_logged_in")){
      showLoginModal();
      return;
    }
    document.body.style.overflow="hidden";
    document.getElementById("modal-player").style.display = "flex";
    location.hash = "id=" + encodeURIComponent(currentMovie.id);
    const fileId = currentMovie.drive && currentMovie.drive.match(/[-\w]{25,}/);
    const embedUrl = fileId ? `https://drive.google.com/file/d/${fileId}/preview` : "";
    document.getElementById("player").innerHTML = embedUrl
      ? `<iframe src="${embedUrl}" allow="autoplay" allowfullscreen style="width:100%;min-height:100px;max-width:99vw;height:39vw;max-height:220px;border-radius:11px;"></iframe>`
      : '<div>Không có video</div>';
    document.getElementById("movie-detail").innerHTML = `
      <h2 id="detail-title">${currentMovie.title}</h2>
      <button class="share-btn" onclick="copyMovieLink()">Chia sẻ</button>
      <div><b style="color:#ffe27a;">Thể loại:</b> ${currentMovie.genre||""} | <b style="color:#ffe27a;">Năm:</b> ${currentMovie.year||""} | ${currentMovie.rating?`<span style="color:#ffd400;">★ ${currentMovie.rating.toFixed(1)}/5</span>`:"Chưa có điểm"}</div>
      <div id="detail-desc">${currentMovie.desc||""}</div>
    `;
    renderSuggestion(currentMovie);
    showPopupMovieHub();
  }
  function copyMovieLink() {
    let link = window.location.origin + window.location.pathname + location.hash;
    navigator.clipboard.writeText(link);
    alert("Đã copy link phim: " + link);
  }
  function renderSuggestion(movie){
    let suggest = movieData.filter(m=>m.genre===movie.genre && m.id!==movie.id);
    document.getElementById("suggestion-title").innerText = suggest.length?"Phim liên quan:":"";
    document.getElementById("suggest-row").innerHTML = suggest.map(m=>`
      <div class="suggest-card" onclick="openPlayer('${m.id}'); event.stopPropagation();">
        <img src="${m.poster||'https://img.icons8.com/color/480/movie-projector.png'}" />
        <div class="s-title">${m.title}</div>
      </div>`).join('');
  }
  function closePlayer() {
    document.getElementById("modal-player").style.display = "none";
    document.body.style.overflow="";
    document.getElementById("player").innerHTML="";
    document.getElementById("movie-detail").innerHTML="";
    document.getElementById("suggestion-title").innerHTML = "";
    document.getElementById("suggest-row").innerHTML = "";
    currentMovie = null;
    history.replaceState(null, null, window.location.pathname);
  }
  function scrollToMain() {
    document.getElementById('movie-rows').scrollIntoView({behavior:'smooth'});
  }
  window.addEventListener("load", async ()=> {
    await fetchUsers();
    await fetchMovies();
    renderGenres();
    renderMovies();
    if(localStorage.getItem("user_logged_in")){
      document.getElementById('logout-btn').style.display='inline-block';
    }
    if (location.hash.startsWith("#id=")) {
      let id = decodeURIComponent(location.hash.slice(4));
      openPlayer(id);
    }
  });
  window.addEventListener("hashchange", ()=>{
    if (location.hash.startsWith("#id=")) {
      let id = decodeURIComponent(location.hash.slice(4));
      openPlayer(id);
    } else {
      closePlayer();
    }
  });
  document.getElementById("search").addEventListener("input", renderMovies);
  document.getElementById("genres").addEventListener("change", renderMovies);
  </script>
</body>
</html>
