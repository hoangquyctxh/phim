<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"/>
  <title>MovieHub - Google Drive Proxy, UI Cao c·∫•p, Secure & Responsive</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Web phim proxy Google Drive chu·∫©n qu·ªëc t·∫ø: b·∫£o m·∫≠t, t·ªëc ƒë·ªô, giao di·ªán ƒë·∫πp, mobile-first, code t·ªëi ∆∞u.">
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css"/>
  <style>
    html,body{background:var(--bg-main);}
    :root { --bg-main: #131625; --bg-modal: #23222c; --txt-main: #fff;
      --phim-card: #252a38; --toolbar-title: #f7e47b; --accent: #e50914; --accent2: #ffe066;}
    body {font-family: 'Manrope','Arial',sans-serif; color:var(--txt-main); margin:0; font-size:17px;}
    header{display:flex;align-items:center;gap:15px;padding:16px 4vw;background:linear-gradient(93deg,#232335 83%,#301d34 101%);}
    .logo{height:40px;}
    .title{font-size:clamp(1.32em,3vw,2.15em);color:var(--accent);font-weight:800;margin-left:2px;text-shadow:0 2px 14px #e5091441;}
    .right{margin-left:auto;display:flex;gap:15px;align-items:center;}
    .btn, .btnshare{padding:9px 18px;border:none;border-radius:9px;background:var(--accent);color:#fff;font-weight:800;cursor:pointer;box-shadow:0 6px 22px #e5091423;font-size:1em;}
    .btn:hover,.btnshare:hover{background:#bb0917;}
    .btn:active{transform:scale(.98);}
    #genreFilter{padding:8px 13px;font-size:1em;border-radius:7px;background:#28223c;color:var(--accent2);}
    #themeToggle{margin-left:14px;padding:8px 14px;}
    .container{max-width:1150px;margin:0 auto;padding:27px 4vw 70px 4vw;}
    h2{margin:40px 0 30px 0;text-shadow:0 2px 13px #e5091432;font-size:clamp(1.27em,3vw,2em);font-weight:800;}
    .row-title{color:var(--accent2);font-size:1.11em;margin:34px 0 18px 9px;font-weight:800;text-shadow:0 2px 13px #e509144c;}
    .phimlist{display:flex;flex-wrap:wrap;gap:23px;justify-content:center;}
    .phimcard{background:var(--phim-card);border-radius:22px;padding:0 0 14px 0;box-shadow:0 4px 27px #15153b24;overflow:hidden;position:relative;margin-bottom:15px;min-width:210px;max-width:335px;flex:1 1 285px;transition:.17s;opacity:0;cursor:pointer;border:2.2px solid transparent;}
    .phimcard.appear{animation:flyIn .56s cubic-bezier(.23,.74,.42,1.11) forwards;}
    .phimcard:hover{transform:scale(1.05) translateY(-12px);box-shadow:0 19px 45px #e5091421,0 1px 27px #ffe06633;border:2.2px solid var(--accent2);}
    .phimimg{width:100%;aspect-ratio:2/3;object-fit:cover;}
    .phimtitle{font-size:1.16em;margin:13px 15px 4px 15px;font-weight:800;}
    .badge-new{display:inline-block;background:var(--accent);color:#fff;padding:2px 11px;border-radius:9px;margin:8px 0 0 13px;}
    .badge-locked{background:#aabbc7;color:#173;padding:2px 11px;border-radius:8px;font-size:.99em;position:absolute;top:12px;right:14px;}
    .watchbtn{margin:13px 0 0 16px;padding:8px 21px;font-size:1.03em;}
    .watchbtn.locked{background:#666;color:#ccc;}
    .phimdesc, .phimmeta, .phimrate, .phimcast, .phimid, .phimtr, .phimcmt{
      margin:0 15px 3px 15px;line-height:1.48;}
    .phimdesc{color:#f2e9ce;font-size:.99em;}
    .phimmeta{color:var(--accent2);font-size:.98em;}
    .phimid{color:#cee7ff;font-size:.93em;}
    .phimrate{color:#f6d97e;}
    .phimtr{color:#b9f;}
    .phimcast{color:#aefacb;}
    .phimcmt{color:#b9bcc4;font-style:italic;font-size:.96em}
    .modal{position:fixed;inset:0;background:#11172add;backdrop-filter:blur(8px) brightness(.99);display:flex;align-items:center;justify-content:center;z-index:9999;}
    .modalDriveCustom{
      background:linear-gradient(130deg,#23222c 89%,#23223e 120%);
      border-radius:25px;box-shadow:0 8px 56px #1919274d;padding:27px 22px 18px 22px;margin:0 auto;min-width:280px;max-width:800px;width:98vw;max-height:98vh;position:relative;overflow-y:auto;animation:popModalIn .52s;}
    .movie-player-plyr {display:none;margin-bottom:15px;}
    .movie-player-iframe {display:none;margin-bottom:14px;}
    .modalDriveCustom.show-plyr .movie-player-plyr {display:block;}
    .modalDriveCustom.show-drive .movie-player-iframe {display:block;}
    .plyr {border-radius:14px;box-shadow:0 8px 38px #0007;}
    .player-toolbar{display:flex;align-items:center;justify-content:space-between;margin-top:10px;}
    .btnshare[data-tip]:hover:after{content: attr(data-tip)" üöÄ";position:absolute;top:-50px;right:-6px;background:#262a6c;color:var(--accent2);padding:8px 15px;border-radius:8px;font-size:1em;white-space:nowrap;z-index:22;box-shadow:0 3px 21px #0019,0 1px 11px #ffe0663c;opacity:1;}
    #playerFields{margin:17px 5px 0 3px;line-height:1.61;}
    .closebtn2{position:absolute;right:11px;top:11px;background:var(--accent);color:var(--accent2);border:none;border-radius:13px;padding:7px 13px;font-size:1.22em;font-weight:900;cursor:pointer;}
    .footer-moviehub{background:#19192c;color:#e6ceb0;text-align:center;padding:20px 4vw 11px 4vw;margin-top:38px;font-size:1.05em;}
    .footer-logo{height:35px;}
    #globalLoading {display:flex;align-items:center;justify-content:center;position:fixed;inset:0;z-index:99999;background:#14161a;transition:.41s;opacity:1;}
    #globalLoading.done{opacity:0;pointer-events:none;}
    #globalLoading .spinner{width:39px;height:39px;border-radius:50%;border:6px solid #ffe066;border-top:6px solid #e50914;animation:spin1 0.8s infinite linear;}
    @keyframes spin1 {to{transform:rotate(360deg);}}
    @keyframes flyIn{0%{opacity:0;transform:translateY(30px) scale(.97);}100%{opacity:1;transform:translateY(0) scale(1);}}
    @keyframes popModalIn{0%{opacity:0;transform:scale(.88) translateY(80px);}100%{opacity:1;transform:scale(1) translateY(0);}
    }
    @media (max-width:900px){.container{max-width:99vw;padding:7vw 1vw 27vw 1vw;}.phimcard{max-width:99vw;flex:1 1 98vw;}}
    @media (max-width:600px){.phimdesc,.phimmeta,.phimid{font-size:.97em;}.modalDriveCustom{max-width:97vw;min-width:90vw;padding:16px 4vw 12px 4vw;}}
  </style>
</head>
<body>
<div id="globalLoading"><div class="spinner"></div></div>
<header>
  <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a75fa0ae-d935-45d3-a56a-67182b3177fa.png" class="logo" alt="MovieHub"/>
  <span class="title">MovieHub</span>
  <select id="genreFilter"><option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option></select>
  <button id="themeToggle" class="btn" onclick="toggleTheme()" aria-label="ƒê·ªïi giao di·ªán t·ªëi/s√°ng">üåô</button>
  <div class="right"></div>
</header>
<div class="container" role="main">
  <h2>Web phim hi·ªán ƒë·∫°i: b·∫£o m·∫≠t, t·ªëc ƒë·ªô, tr√¨nh ph√°t Drive/Proxy, hi·ªáu ·ª©ng t·ªëi ∆∞u cho m·ªçi thi·∫øt b·ªã</h2>
  <div id="genreRows"></div>
</div>
<div id="playerModal" class="modal" style="display:none;" aria-modal="true">
  <div class="modalDriveCustom" onclick="event.stopPropagation();">
    <button class="closebtn2" onclick="closePlayer()" aria-label="ƒê√≥ng player phim">&times;</button>
    <div class="movie-player-plyr"><video id="plyrVideo" playsinline controls poster="" style="width:100%;" crossorigin="anonymous"></video></div>
    <div class="movie-player-iframe"><iframe id="driveFrame" style="width:100%;aspect-ratio:16/9;min-height:210px;border-radius:16px;background:#000;border:none;"></iframe></div>
    <div class="player-toolbar">
      <span id="playerTitle" style="font-size:1.13em;font-weight:700;"></span>
      <button class="btnshare" onclick="copyPlayerLink()" data-tip="D√°n link phim cho b·∫°n b√®">üìã Sao ch√©p link phim</button>
    </div>
    <div id="playerFields"></div>
  </div>
</div>
<footer class="footer-moviehub">
  <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a75fa0ae-d935-45d3-a56a-67182b3177fa.png" alt="MovieHub Logo" class="footer-logo"/>
  <div class="footer-content"><b style="font-size:1.13em;">MovieHub</b><br>Li√™n h·ªá: moviehub_vn@hotmail.com</div>
</footer>
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<script>
const SHEET_ID = '15mFrve7Z-_zi_7AvSq3t9Nti1VjINVHCQDF7LRmP1QQ';
const API_KEY = 'AIzaSyD5dWLgYZPu1_-AkwAaHPClGOOQ-Lq5EGI';
const SHEET_RANGE = 'Sheet1!A1:Z';
let phimList = [], genresSet = new Set();

function extractFileId(link) {
  let m = link.match(/file\/d\/([a-zA-Z0-9_-]+)/) || link.match(/[?&]id=([a-zA-Z0-9_-]+)/) || link.match(/^([a-zA-Z0-9_-]{25,})$/);
  return m ? m[1] : null;
}
async function getGdPlayerProxyMp4(fileId){
  try{const api=`https://gdplayer.vip/api/video?file_id=${fileId}`;const res=await fetch(api);if(!res.ok)return null;const dt=await res.json();return dt.file;}catch(e){return null;}
}
async function showPhim(_id){
  let m = phimList.find(m=>encodeURIComponent(m.id)===_id);
  if(!m) return alert("Kh√¥ng t√¨m th·∫•y phim");
  location.hash = "id=" + encodeURIComponent(m.id);
  let fileId = extractFileId(m.drive);
  let modal = document.querySelector('.modalDriveCustom');
  document.getElementById('playerTitle').innerText = m.title;
  document.getElementById('playerFields').innerHTML = `
    <b>M√¥ t·∫£:</b> ${m.desc||''}<br>
    <b>Th·ªÉ lo·∫°i:</b> ${m.genre||''}<br>
    <b>NƒÉm:</b> ${m.year||''}<br>
    <b>ID:</b> ${m.id||''}<br>
    <b>Link Google Drive:</b> <a href="${m.drive}" target="_blank" style="color:#76fc;">Xem g·ªëc</a><br>
    <b>ƒêi·ªÉm trung b√¨nh:</b> ${m.diem||''}<br>
    <b>Comments:</b> ${m.comments||''}<br>
    <b>Trailer:</b> ${m.trailer?`<a href="${m.trailer}" target="_blank" style="color:#ea7">Xem trailer</a>`:''}<br>
    <b>Di·ªÖn vi√™n/ƒê·∫°o di·ªÖn:</b> ${m.cast||''}
  `;
  function fallbackDrivePreview() {
    document.querySelector('.movie-player-iframe').style.display = 'block';
    document.querySelector('.movie-player-plyr').style.display = 'none';
    document.getElementById('driveFrame').src=fileId?`https://drive.google.com/file/d/${fileId}/preview`:m.drive;
    modal.classList.remove('show-plyr'); modal.classList.add('show-drive');
  }
  if(fileId){
    getGdPlayerProxyMp4(fileId).then(res=>{
      if(res){
        document.querySelector('.movie-player-iframe').style.display = 'none';
        document.querySelector('.movie-player-plyr').style.display = 'block';
        let plyr = document.getElementById('plyrVideo');
        plyr.poster = m.poster||'';
        plyr.src = res; // fallback
        window.playerPlyr = new Plyr('#plyrVideo',{controls:['play-large','play','progress','current-time','duration','mute','volume','settings','fullscreen'],settings:['quality','speed','loop'],ratio:'16:9'});
        playerPlyr.source = {type:"video",sources:[{src:res,type:'video/mp4',size:720}]};
        modal.classList.remove('show-drive'); modal.classList.add('show-plyr');
      }else fallbackDrivePreview();
    }).catch(fallbackDrivePreview);
  }else{ fallbackDrivePreview(); }
  document.getElementById('playerModal').style.display = 'flex';
}
function closePlayer(){
  document.getElementById('driveFrame').src='';
  if(window.playerPlyr) window.playerPlyr.pause();
  document.getElementById('playerModal').style.display='none';
  document.querySelector('.modalDriveCustom').classList.remove('show-drive','show-plyr');
  history.replaceState(null,null,window.location.pathname);
}
function copyPlayerLink() {
  let link=window.location.origin+window.location.pathname+location.hash;
  navigator.clipboard.writeText(link);alert("ƒê√£ sao ch√©p link phim: "+link);
}
async function fetchPhim() {
  let url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_RANGE}?key=${API_KEY}`;
  let res = await fetch(url); let data = await res.json();
  let rows = data.values||[], header = rows[0];
  let idx = n => header.findIndex(x=>x&&x.trim().toLowerCase() === n);
  phimList = rows.slice(1).map(row=>({
    title:row[idx('t√™n phim')]||'',
    desc:row[idx('m√¥ t·∫£')]||'',
    genre:row[idx('th·ªÉ lo·∫°i')]||'',
    year:row[idx('nƒÉm')]||'',
    id:row[idx('id')]||'',
    drive:row[idx('link google drive')]||'',
    poster:row[idx('link poster')]||'',
    diem:row[idx('ƒëi·ªÉm trung b√¨nh')]||'',
    comments:row[idx('comments')]||'',
    trailer:row[idx('trailer')]||'',
    cast:row[idx('di·ªÖn vi√™n/ƒë·∫°o di·ªÖn')]||'',
    isNew: row[idx('nƒÉm')] && +row[idx('nƒÉm')] >= (new Date().getFullYear()-1)
  })).filter(m=>m.title);
  genresSet = new Set(phimList.map(m=>m.genre).filter(g=>g!==''));
  updateGenreOptions();renderPhim();
}
function updateGenreOptions() {
  let sel = document.getElementById("genreFilter");
  sel.innerHTML = `<option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
    ${Array.from(genresSet).map(g=>`<option value="${g}">${g}</option>`).join('')}`;
}
function renderPhim() {
  const sel = document.getElementById("genreFilter");
  let selected = sel.value || '';
  let phimTheoGenre = {};
  phimList.filter(m=>!selected||m.genre===selected)
    .forEach(m=>(phimTheoGenre[m.genre]=phimTheoGenre[m.genre]||[]).push(m));
  let html = '';
  for(const genre of Object.keys(phimTheoGenre)){
    html += `<div class="row-title">${genre}</div>
      <div class="phimlist">${
        phimTheoGenre[genre].map(m=>`<div class="phimcard" onclick="showPhim('${encodeURIComponent(m.id)}')">
        ${m.isNew?'<span class="badge-new">M·ªöI</span>':''}
        <img class="phimimg" src="${m.poster||'https://img.icons8.com/color/480/movie-projector.png'}" alt="">
        <div class="phimtitle">${m.title}</div>
        <div class="phimmeta">Th·ªÉ lo·∫°i: ${m.genre||'Ch∆∞a r√µ'} | NƒÉm: ${m.year||''}</div>
        <div class="phimid">ID: ${m.id||''}</div>
        <div class="phimdesc">${m.desc||''}</div>
        ${m.diem?`<div class="phimrate">‚≠ê ƒêi·ªÉm: ${m.diem}</div>`:''}
        ${m.trailer?`<div class="phimtr">üé¨ Trailer: <a href="${m.trailer}" target="_blank" style="color:#f7b;">Xem trailer</a></div>`:''}
        ${m.cast?`<div class="phimcast">üë§ Di·ªÖn vi√™n/ƒê·∫°o di·ªÖn: ${m.cast}</div>`:''}
        ${m.comments?`<div class="phimcmt">üí¨ ${m.comments}</div>`:''}
        <button class="btn watchbtn" tabindex="-1" onclick="event.stopPropagation();showPhim('${encodeURIComponent(m.id)}')">
          Xem phim
        </button>
      </div>`).join('')
      }</div>`;
  }
  document.getElementById('genreRows').innerHTML = html;
  setTimeout(()=>{document.querySelectorAll('.phimcard').forEach((el,i)=>setTimeout(()=>el.classList.add('appear'),80*i));},50);
}
window.onload = async ()=>{
  document.getElementById('globalLoading').classList.remove('done');
  await fetchPhim();
  setTimeout(()=>{document.getElementById('globalLoading').classList.add('done');},220);
  if(location.hash.startsWith("#id=")){ let id=decodeURIComponent(location.hash.slice(4)); showPhim(encodeURIComponent(id)); }
}
window.addEventListener("hashchange",()=>{ if(location.hash.startsWith("#id=")){ let id=decodeURIComponent(location.hash.slice(4)); showPhim(encodeURIComponent(id));} else closePlayer();});
document.getElementById("genreFilter").addEventListener("change",renderPhim);
function toggleTheme() {
  const body=document.body;
  if(body.classList.contains("lightmode")){
    body.classList.remove("lightmode");
    document.getElementById('themeToggle').innerText='üåô';localStorage.setItem("moviehub_theme",'dark');
  }else{
    body.classList.add("lightmode");
    document.getElementById('themeToggle').innerText='‚òÄÔ∏è';localStorage.setItem("moviehub_theme",'light');
  }
}
</script>
</body>
</html>
