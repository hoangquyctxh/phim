<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"/>
  <title>MovieHub ‚Äì Xem phim Google Drive Proxy</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes"/>
  <meta name="theme-color" content="#181818"/>
  <meta name="description" content="MovieHub - web xem phim Google Drive an to√†n, proxy nhanh, watermark, t·ªëi ∆∞u mobile.">
  <link rel="icon" type="image/svg+xml" href="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a75fa0ae-d935-45d3-a56a-67182b3177fa.png">
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css"/>
  <style>
    :root{--bg-main:#16182a;--accent:#e50914;--accent2:#ffe066;--bg-modal:#252438ed;--card:#232943f1;--avatar:#f5f8ee;}
    body{font-family:'Manrope',Arial,Verdana,sans-serif;background:var(--bg-main);margin:0;color:#fff;}
    .container{max-width:1080px;margin:0 auto;padding:25px 5vw 70px 5vw;}
    header{display:flex;align-items:center;gap:14px;padding:13px 1vw 11px 0;background:linear-gradient(98deg,#201833 82%,#4f2244 110%);}
    .logo{height:38px;width:38px;margin-right:6px;}
    .title{font-size:clamp(1.33em,3vw,2em);color:var(--accent);font-weight:900;}
    .right{margin-left:auto;display:flex;gap:14px;}
    .btn,.btnshare{padding:8px 20px;border:none;border-radius:8px;background:var(--accent);color:#fff;font-weight:800;cursor:pointer;box-shadow:0 3px 14px #e509142a;}
    .btn:hover,.btnshare:hover{background:#a81019;}
    #genreFilter{padding:8px 13px;border-radius:7px;background:#292a3a;color:var(--accent2);}
    #themeToggle{margin-left:10px;}
    .searchbox{padding:9px 17px;font-size:1em;border-radius:7px;border:none;background:#31314a;color:#ffe;}
    h2{margin:30px 0 21px 0;font-size:clamp(1.15em,3vw,1.62em);}
    .slider-preview{overflow-x:auto;display:flex;gap:15px;margin:8px 0 10px 0;}
    .slider-preview img{height:74px;border-radius:11px;}
    .slider-preview img:hover{box-shadow:0 4px 14px #ffe066;}
    .row-title{color:var(--accent2);font-size:1.03em;margin:33px 0 11px 7px;font-weight:700;text-shadow:0 1px 4px #e5091434;}
    .phimlist{display:flex;flex-wrap:wrap;gap:16px;}
    .phimcard{background:#232943f0;border-radius:14px;padding:0 0 13px 0;box-shadow:0 3px 14px #28283b22;position:relative;min-width:190px;max-width:285px;flex:1 1 220px;transition:.14s;opacity:0;cursor:pointer;}
    .phimcard.appear{animation:flyIn .52s cubic-bezier(.23,.7,.42,1.07) forwards;}
    .phimcard:hover{transform:scale(1.04) translateY(-8px);}
    .phimimg{width:100%;aspect-ratio:2/3;object-fit:cover;border-bottom:2px solid #232436;}
    .phimtitle{font-size:1.07em;margin:11px 13px 4px 13px;font-weight:800;}
    .badge-new{display:inline-block;background:var(--accent);color:#fff;padding:2px 9px;border-radius:8px;margin:7px 0 0 12px;font-size:.98em;}
    .badge-locked{background:#bcf;color:#154;padding:2px 8px;border-radius:7px;position:absolute;top:11px;right:9px;font-size:.96em;}
    .phimdesc,.phimmeta,.phimcast{margin:0 13px 3px 11px;font-size:.94em;}
    .phimdesc{color:#f2e5ca;}.phimmeta{color:var(--accent2);}
    .phimcast{color:#b6fddf;}
    .watchbtn{margin:9px 0 0 14px;padding:7px 17px;}
    .watchbtn.locked{background:#666;color:#ccc;}
    .avatar{background:var(--avatar);border-radius:50%;width:36px;height:36px;display:inline-block;box-shadow:0 1px 10px #3126;}
    .masonry{column-count:3;column-gap:16px;}@media(max-width:970px){.masonry{column-count:2;}}@media(max-width:600px){.masonry{column-count:1;}}
    .modal{position:fixed;inset:0;background:#161a28d0;backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;z-index:9000;}
    .modalDriveCustom{background:var(--bg-modal);border-radius:18px;box-shadow:0 7px 41px #13142556;padding:19px 15px 11px 15px;max-width:410px;width:95vw;max-height:96vh;position:relative;}
    .closebtn2{position:absolute;right:10px;top:10px;background:var(--accent);color:#ffe066;border:none;border-radius:10px;padding:7px 11px;font-size:1.11em;font-weight:900;cursor:pointer;}
    .movie-player-plyr{display:none;margin-bottom:7px;}
    .movie-player-iframe{display:none;margin-bottom:7px;}
    .modalDriveCustom.show-plyr .movie-player-plyr{display:block;}
    .modalDriveCustom.show-drive .movie-player-iframe{display:block;}
    .plyr{border-radius:10px;box-shadow:0 3px 20px #0005;}
    .watermark-logo{position:absolute;right:12px;bottom:12px;opacity:.08;z-index:5;user-select:none;height:43px;width:auto;max-width:22vw;}
    #playerFields{margin:13px 1px 0 1px;line-height:1.54;}
    #loginModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#232336dd;z-index:13000;}
    .modalDriveCustom input{width:91%;margin-bottom:11px;border-radius:7px;border:none;padding:11px;font-size:1em;background:#252c3f;color:#fff;}
    .errmsg{color:#f16;font-size:.98em;font-weight:600;}
    .toast{position:fixed;right:18px;bottom:11px;z-index:20030;background:#15172cdd;color:#ffe066;padding:13px 19px;border-radius:10px;font-size:.98em;box-shadow:0 2px 15px #e5091477;font-weight:700;display:none;}
    .footer-moviehub{background:#18192e;color:#ebddbc;text-align:center;padding:14px 4vw 8px 4vw;margin-top:33px;}
    .footer-logo{height:27px;opacity:.93;}
    #globalLoading{display:flex;align-items:center;justify-content:center;position:fixed;inset:0;z-index:99999;background:#10121c;transition:.30s;opacity:1;}
    #globalLoading.done{opacity:0;pointer-events:none;}
    #globalLoading .spinner{width:33px;height:33px;border-radius:50%;border:5px solid #ffe066;border-top:5px solid #e50914;animation:spin1 .77s infinite linear;margin-right:7px;}
    @keyframes spin1{to{transform:rotate(360deg)}}
    @keyframes flyIn{0%{opacity:0;transform:translateY(24px) scale(.94);}100%{opacity:1;transform:translateY(0) scale(1);}}
    .ripple{position:absolute;pointer-events:none;border-radius:50%;background:var(--accent2)44;transform:scale(.7);animation:rippleAnim .7s linear;}
    @keyframes rippleAnim{to{opacity:0;transform:scale(2.2);}}
  </style>
</head>
<body>
<div id="globalLoading"><div class="spinner"></div>ƒêang t·∫£i d·ªØ li·ªáu phim...</div>
<header>
  <img class="logo" src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a75fa0ae-d935-45d3-a56a-67182b3177fa.png" alt="MovieHub Logo"/>
  <span class="title">MovieHub</span>
  <input class="searchbox" id="quickSearch" placeholder="T√¨m phim/T√¨m di·ªÖn vi√™n..."/>
  <select id="genreFilter"><option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option></select>
  <button id="themeToggle" class="btn" onclick="toggleTheme()" aria-label="ƒê·ªïi theme">üåô</button>
  <div class="right">
    <span id="userPanel"></span>
    <button id="loginBtn" class="btn" onclick="showLogin()" style="margin-left:8px;">ƒêƒÉng nh·∫≠p</button>
    <button id="logoutBtn" class="btn" onclick="logoutUser()" style="display:none;margin-left:8px;">ƒêƒÉng xu·∫•t</button>
  </div>
</header>
<div class="container" role="main">
  <h2>MovieHub ‚Äì Xem phim Google Drive t·ªëc ƒë·ªô cao, t√¨m ki·∫øm, responsive, b·∫£o m·∫≠t</h2>
  <div class="slider-preview" id="sliderPreview"></div>
  <div id="genreRows" class="masonry"></div>
</div>
<div id="toastMsg" class="toast" aria-live="assertive"></div>
<div id="loginModal" class="modal" aria-modal="true"><div class="modalDriveCustom" style="max-width:420px;">
  <button class="closebtn2" onclick="closeLogin()" aria-label="ƒê√≥ng">&times;</button>
  <div style="color:#ffe066;margin:12px 2px 14px 2px;font-size:1.11em;font-weight:700;">ƒêƒÉng nh·∫≠p th√†nh vi√™n</div>
  <input id="loginUser" placeholder="T√†i kho·∫£n..." autocomplete="username"/>
  <input id="loginPass" type="password" placeholder="M·∫≠t kh·∫©u..." autocomplete="current-password"/>
  <button class="btn" onclick="doLogin()" style="width:100%">ƒêƒÉng nh·∫≠p</button>
  <div class="errmsg" id="loginErr" style="display:none;margin-top:9px;"></div>
</div></div>
<div id="playerModal" class="modal" style="display:none;" aria-modal="true"><div class="modalDriveCustom">
  <button class="closebtn2" onclick="closePlayer()" aria-label="ƒê√≥ng player phim">&times;</button>
  <div class="movie-player-plyr" style="display:none"><video id="plyrVideo" controls poster="" style="width:100%;" crossorigin="anonymous"></video></div>
  <div class="movie-player-iframe" style="display:none"><iframe id="driveFrame" allowfullscreen allow="autoplay; fullscreen" style="width:100%;min-height:210px;border-radius:12px;background:#181818;border:none;"></iframe></div>
  <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a75fa0ae-d935-45d3-a56a-67182b3177fa.png" class="watermark-logo" alt="MovieHub Watermark"/>
  <div class="player-toolbar"><span id="playerTitle" class="player-title"></span><button class="btnshare" onclick="copyPlayerLink()" style="margin-left:11px;">üìã Sao ch√©p link</button></div>
  <div id="playerFields"></div>
</div></div>
<footer class="footer-moviehub">
  <img src="https://user-gen-media-assets.s3.amazonaws.com/seedream_images/a75fa0ae-d935-45d3-a56a-67182b3177fa.png" alt="MovieHub Logo" class="footer-logo"/>
  <div class="footer-content">MovieHub &copy; 2025 ‚Äì Xem phim Google Drive an to√†n, ti·ªán d·ª•ng</div>
</footer>
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<script>
const SHEET_ID = '15mFrve7Z-_zi_7AvSq3t9Nti1VjINVHCQDF7LRmP1QQ';
const API_KEY = 'AIzaSyD5dWLgYZPu1_-AkwAaHPClGOOQ-Lq5EGI';
const SHEET_RANGE = 'Sheet1!A1:Z';
const USERS_RANGE = 'Users!A2:C';
let phimList=[], genresSet=new Set(), loggedUser = false, userList=[], sessionUser=null;
function showToast(msg,dur=2000){
  let t=document.getElementById('toastMsg'); t.textContent=msg;t.style.display="block";
  setTimeout(()=>t.style.display="none",dur);}
function toggleTheme(){ const body=document.body;
  if(body.classList.contains("lightmode")){body.classList.remove("lightmode");document.getElementById('themeToggle').innerText='üåô';localStorage.setItem("moviehub_theme",'dark');}
  else{body.classList.add("lightmode");document.getElementById('themeToggle').innerText='‚òÄÔ∏è';localStorage.setItem("moviehub_theme",'light');}}
function playRipple(el,e){const r=document.createElement('span');r.className='ripple';const rect=el.getBoundingClientRect(),size=Math.max(rect.width,rect.height)*.7,x=e.clientX-rect.left-size/2,y=e.clientY-rect.top-size/2;r.style.cssText=`width:${size}px;height:${size}px;top:${y}px;left:${x}px;`;el.appendChild(r);setTimeout(()=>el.removeChild(r),600);}
function showLogin(){document.getElementById('loginModal').style.display='flex';document.getElementById('loginUser').value='';document.getElementById('loginPass').value='';document.getElementById('loginErr').style.display='none';}
function closeLogin(){document.getElementById('loginModal').style.display='none';}
function doLogin(){
  let user=document.getElementById('loginUser').value.trim(),pass=document.getElementById('loginPass').value.trim();
  let found=userList.find(u=>u.user===user&&u.pass===pass);
  if(found){loggedUser=true;sessionUser=user;closeLogin();renderPhim();showToast('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!');
    document.getElementById('loginBtn').style.display="none";
    document.getElementById('logoutBtn').style.display="inline-block";
    document.getElementById('userPanel').innerHTML = `<span class="avatar" title="T√†i kho·∫£n: ${user}">${user[0].toUpperCase()}</span>`;
  }else{document.getElementById('loginErr').innerText='Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!';document.getElementById('loginErr').style.display='block';}
}
function logoutUser(){
  loggedUser=false;sessionUser=null;
  document.getElementById('userPanel').innerHTML='';
  document.getElementById('loginBtn').style.display="inline-block";
  document.getElementById('logoutBtn').style.display="none";
  showToast("ƒê√£ ƒëƒÉng xu·∫•t!");renderPhim();
}
async function fetchUsers(){
  const url=`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${USERS_RANGE}?key=${API_KEY}`;
  let res=await fetch(url);let data=await res.json();userList=(data.values||[]).map(r=>({user:r[0],pass:r[1],role:r[2]}));
}
function extractFileId(link){
  let m=link.match(/file\/d\/([a-zA-Z0-9_-]+)/)||link.match(/[?&]id=([a-zA-Z0-9_-]+)/)||link.match(/^([a-zA-Z0-9_-]{25,})$/);return m?m[1]:null;}
async function getGdPlayerProxyMp4(fileId){
  try{const api=`https://gdplayer.vip/api/video?file_id=${fileId}`;const res=await fetch(api);if(!res.ok)return null;const dt=await res.json();return dt.file;}catch(e){return null;}
}
async function showPhim(_id){
  let m=phimList.find(m=>encodeURIComponent(m.id)===_id);
  if(!m) return showToast("Kh√¥ng t√¨m th·∫•y phim!");
  document.getElementById('playerTitle').innerText=m.title;
  document.getElementById('playerFields').innerHTML=[`<div><b>M√¥ t·∫£:</b> ${m.desc||''}</div>`,`<div><b>NƒÉm:</b> ${m.year||''}</div>`,`<div><b>Th·ªÉ lo·∫°i:</b> ${m.genre||''}</div>`,m.cast?`<div><b>Di·ªÖn vi√™n/ƒê·∫°o di·ªÖn:</b> ${m.cast}</div>`:''].join('');
  let fileId=extractFileId(m.drive),modal=document.querySelector('.modalDriveCustom'),plyrWrap=document.querySelector('.movie-player-plyr'),ifrWrap=document.querySelector('.movie-player-iframe'),plyr=document.getElementById('plyrVideo'),ifr=document.getElementById('driveFrame');plyrWrap.style.display=ifrWrap.style.display="none";
  if(m.special&&!loggedUser){showToast("Phim n√†y y√™u c·∫ßu ƒëƒÉng nh·∫≠p.");closePlayer();showLogin();return;}
  document.getElementById('playerModal').style.display='flex';
  if(fileId){
    getGdPlayerProxyMp4(fileId).then(res=>{
      if(res){
        if(window.playerPlyr) try{window.playerPlyr.destroy();}catch(e){}
        ifrWrap.style.display="none";plyrWrap.style.display="block";plyr.poster=m.poster||'';plyr.src=res;
        window.playerPlyr=new Plyr('#plyrVideo',{controls:['play-large','play','progress','current-time','duration','mute','volume','settings','fullscreen'], settings:['quality','speed','loop'],ratio:'16:9',fullscreen:{ enabled:true, fallback:true, iosNative:true } });
        playerPlyr.source={type:"video",sources:[{src:res,type:'video/mp4',size:720}]};
        modal.classList.remove('show-drive');modal.classList.add('show-plyr');
      }else{ plyrWrap.style.display="none";ifrWrap.style.display="block";ifr.src=`https://drive.google.com/file/d/${fileId}/preview`;modal.classList.remove('show-plyr');modal.classList.add('show-drive');}
    }).catch(()=>{plyrWrap.style.display="none";ifrWrap.style.display="block";ifr.src=`https://drive.google.com/file/d/${fileId}/preview`;modal.classList.remove('show-plyr');modal.classList.add('show-drive');});
  }else{plyrWrap.style.display="none";ifrWrap.style.display="block";ifr.src=m.drive;modal.classList.remove('show-plyr');modal.classList.add('show-drive');}
}
function closePlayer(){document.getElementById('driveFrame').src='';if(window.playerPlyr)window.playerPlyr.pause();document.getElementById('playerModal').style.display='none';document.querySelector('.modalDriveCustom').classList.remove('show-drive','show-plyr');history.replaceState(null,null,window.location.pathname);}
function copyPlayerLink(){let link=window.location.origin+window.location.pathname+location.hash;navigator.clipboard.writeText(link);showToast("ƒê√£ sao ch√©p link phim: "+link);}
async function fetchPhim(){let url=`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_RANGE}?key=${API_KEY}`;let res=await fetch(url);let data=await res.json();let rows=data.values||[],header=rows[0];let idx=n=>header.findIndex(x=>x&&x.trim().toLowerCase()===n);phimList=rows.slice(1).map(row=>({title:row[idx('t√™n phim')]||'',desc:row[idx('m√¥ t·∫£')]||'',genre:row[idx('th·ªÉ lo·∫°i')]||'',year:row[idx('nƒÉm')]||'',id:row[idx('id')]||'',drive:row[idx('link google drive')]||'',poster:row[idx('link poster')]||'',special:(row[idx('special')]||'').trim().toLowerCase()==='yes',cast:row[idx('di·ªÖn vi√™n/ƒë·∫°o di·ªÖn')]||'',isNew:row[idx('nƒÉm')]&&+row[idx('nƒÉm')]>=((new Date()).getFullYear()-1)})).filter(m=>m.title);genresSet=new Set(phimList.map(m=>m.genre).filter(g=>g&&g!==''));updateGenreOptions();renderPhim();renderSliderPreview();}
function updateGenreOptions(){let sel=document.getElementById("genreFilter");sel.innerHTML=`<option value=\"\">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>${Array.from(genresSet).map(g=>`<option value=\"${g}\">${g}</option>`).join('')}`;}
function renderPhim(){
  const sel=document.getElementById("genreFilter"),search=document.getElementById("quickSearch").value.trim().toLowerCase(),selected=sel.value||'';let phimTheoGenre={};
  phimList.filter(m=>(!selected||m.genre===selected)&&(!search||m.title.toLowerCase().includes(search)||m.genre.toLowerCase().includes(search)||m.desc.toLowerCase().includes(search)||(m.cast||'').toLowerCase().includes(search))).forEach(m=>(phimTheoGenre[m.genre]=phimTheoGenre[m.genre]||[]).push(m));
  let html='';for(const genre of Object.keys(phimTheoGenre)){
    html+=`<div class=\"row-title\">${genre}</div><div class=\"phimlist\">${phimTheoGenre[genre].map(m=>`<div class=\"phimcard\" onclick=\"showPhim('${encodeURIComponent(m.id)}')\" onmousedown=\"playRipple(this,event)\"><span class=\"badge-new\" style=\"${m.isNew?'':'display:none'}\">M·ªöI</span>${m.special?'<span class=\"badge-locked\">Kho√°</span>':''}<img class=\"phimimg\" src=\"${m.poster||'https://img.icons8.com/color/480/movie-projector.png'}\" alt=\"Phim: ${m.title}\"><div class=\"phimtitle\">${m.title}</div><div class=\"phimmeta\">Th·ªÉ lo·∫°i: ${m.genre||'Ch∆∞a r√µ'} | NƒÉm: ${m.year||''}</div><div class=\"phimdesc\">${m.desc||''}</div>${m.cast?`<div class=\"phimcast\">Di·ªÖn vi√™n/ƒê·∫°o di·ªÖn: ${m.cast}</div>`:''}<button class=\"btn watchbtn${m.special?' locked':''}\" tabindex=\"-1\" onclick=\"event.stopPropagation();showPhim('${encodeURIComponent(m.id)}')\">${m.special?'Ch·ªâ th√†nh vi√™n':'Xem phim'}</button></div>`).join('')}</div>`;}
  document.getElementById('genreRows').innerHTML=html;setTimeout(()=>{document.querySelectorAll('.phimcard').forEach((el,i)=>setTimeout(()=>el.classList.add('appear'),55*i));},12);
}
function renderSliderPreview(){
  let arr=[...phimList], k=Math.min(arr.length,9), out=[];
  while(k-- && arr.length){let r=Math.floor(Math.random()*arr.length);out.push(arr[r]);arr.splice(r,1);}
  document.getElementById('sliderPreview').innerHTML=out.map(m=>`<img src="${m.poster||'https://img.icons8.com/color/480/movie-projector.png'}" title="${m.title}" onclick="showPhim('${encodeURIComponent(m.id)}')">`).join('');
}
window.onload=async()=>{
  document.getElementById('globalLoading').classList.remove('done');await fetchUsers();await fetchPhim();
  let th=localStorage.getItem("moviehub_theme");
  if(th==="light"){document.body.classList.add("lightmode");document.getElementById('themeToggle').innerText='‚òÄÔ∏è';}
  else{document.getElementById('themeToggle').innerText='üåô';}
  setTimeout(()=>{document.getElementById('globalLoading').classList.add('done');},99);
  if(location.hash.startsWith("#id=")){let id=decodeURIComponent(location.hash.slice(4));showPhim(encodeURIComponent(id));}
  document.getElementById('loginBtn').style.display="inline-block";
  document.getElementById('logoutBtn').style.display="none";
}
window.addEventListener("hashchange",()=>{if(location.hash.startsWith("#id=")){let id=decodeURIComponent(location.hash.slice(4));showPhim(encodeURIComponent(id));}else closePlayer();});
document.getElementById("genreFilter").addEventListener("change",renderPhim);
document.getElementById("quickSearch").addEventListener("input",()=>{renderPhim();});
// Watermark ƒë·ªông khi player modal m·ªü
let watermarkInterval=null;
function moveWatermark(){const wm=document.querySelector('.watermark-logo');if(!wm)return;wm.style.right=(8+Math.random()*36)+'px';wm.style.bottom=(12+Math.random()*28)+'px';wm.style.opacity=(0.07+Math.random()*0.09).toFixed(2);}
function startWatermark(){moveWatermark();watermarkInterval=setInterval(moveWatermark,2500);}
function stopWatermark(){if(watermarkInterval)clearInterval(watermarkInterval);}
document.getElementById('playerModal').addEventListener('shown',startWatermark);
document.getElementById('playerModal').addEventListener('hidden',stopWatermark);
// Keyboard shortcut Escape ƒë·ªÉ ƒë√≥ng modal
window.addEventListener('keydown',function(e){
  if(document.getElementById('playerModal').style.display==='flex' && e.key==='Escape'){closePlayer();}
  if(document.getElementById('loginModal').style.display==='flex' && e.key==='Escape'){closeLogin();}
});
</script>
</body>
</html>
